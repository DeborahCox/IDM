为了保证精度，请安装时尽可能让传感器线圈板的顶面低于加热块的底面。

在用户目录下执行git clone https://gitee.com/NBTP/IDM.git 下载程序包

执行chmod +x IDM/install.sh
然后执行IDM/install.sh进行安装
这一步会自动把脚本创建一个链接放到klipper/klipper/extra目录下
然后
[idm]
serial:
#canbus_uuid:
#   Path to the serial port for the idm device. Typically has the form
#   /dev/serial/by-id/usb-idm_idm_...
speed: 40.
#   Z probing dive speed.
lift_speed: 5.
#   Z probing lift speed.
backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
x_offset: 0.
#   X offset of idm from the nozzle.
y_offset: 21.1
#   Y offset of idm from the nozzle.
trigger_distance: 2.
#   idm trigger distance for homing.
trigger_dive_threshold: 1.5
#   Threshold for range vs dive mode probing. Beyond `trigger_distance +
#   trigger_dive_threshold` a dive will be used.
trigger_hysteresis: 0.006
#   Hysteresis on trigger threshold for untriggering, as a percentage of the
#   trigger threshold.
cal_nozzle_z: 0.1
#   Expected nozzle offset after completing manual Z offset calibration.
cal_floor: 0.1
#   Minimum z bound on sensor response measurement.
cal_ceil:5.
#   Maximum z bound on sensor response measurement.
cal_speed: 1.0
#   Speed while measuring response curve.
cal_move_speed: 10.
#   Speed while moving to position for response curve measurement.
default_model_name: default
#   Name of default idm model to load.
mesh_main_direction: x
#   Primary travel direction during mesh measurement.
#mesh_overscan: -1
#   Distance to use for direction changes at mesh line ends. Omit this setting
#   and a default will be calculated from line spacing and available travel.
mesh_cluster_size: 1
#   Radius of mesh grid point clusters.
mesh_runs: 2
#   Number of passes to make during mesh scan.
请注意调整配置中的x y方向偏移。确保校准过程中喷头会将线圈移动到原先喷嘴所在xy位置。
将这段配置放进printer.cfg并将serial修改为你查询到的idm的串口号
can版本的话使用常规的查询方法搜索can的uuid并填入
在配置里再加入
[force_move]
enable_force_move: true
方便校准，校准全部结束后可删除

之后把[probe]模块删除
并将z限位修改为probe:z_virtual_endstop
还需要设置
[safe_z_home]
home_xy_position: 【你的x轴中心坐标】,【你的y轴中心坐标】
z_hop: 10
记得设置[bed_mesh]不然会报错

重启之后将热端移动到中间并徒手将喷嘴贴到平台上
输入SET_KINEMATIC_POSITION x=【平台中心x坐标】 y=【平台中心y轴坐标】 z=0
之后执行idm_calibrate的指令
点击-0.1的偏移后确认，会自动进行校准
在控制台输入idm并按tab键可以看到所有支持的指令

将z_tilt或者quad_gantry_level中的horizontal_z_move降到trigger_distance + trigger_dive_threshold以下(默认为3)可以使调平进入高速模式，觉得太低可以适当拉高trigger_dive_threshold使horizontal_z_move可以拉高一些。


含加速计(lis2dw)的版本可以在配置中添加以下内容启用加速计:
[lis2dw]
cs_pin: idm:PA3
spi_bus: spi1

[resonance_tester]
accel_chip: lis2dw
probe_points:
    125, 125, 20  #此处设置为你进行共振测量时喷头所处坐标
